<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Backlogger — Backtesting Game</title>
    <meta name="description" content="Gamified backtesting with money-focused progression, ranks, and achievements." />
    <meta name="theme-color" content="#0b0f14" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Modern game-like pairing: Orbitron (titles) + Inter (UI) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./src/styles.css" />
  </head>
  <body>
    <div class="bg-grid"></div>

    <header class="app-header">
      <div class="brand">
        <div class="logo">BL</div>
        <h1>Backlogger</h1>
      </div>
      <nav class="nav">
        <button class="nav-btn is-active" data-view="dashboard">Dashboard</button>
        <button class="nav-btn" data-view="challenge">Challenge</button>
  <button class="nav-btn" data-view="log">Weekly Log</button>
        <button class="nav-btn" data-view="records">Records</button>
      </nav>
      <div class="user">
        <div class="rank-badge" id="rankBadge">
          <span class="rank-title">Novice</span>
        </div>
        <div class="balance" id="topBalance">$10,000</div>
        <button class="icon-btn" id="settingsBtn" title="Settings" aria-label="Open Settings" type="button">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7Zm9.44 3.06-1.77-.3a7.28 7.28 0 0 0-.62-1.49l1.05-1.46a.75.75 0 0 0-.1-.97l-1.6-1.6a.75.75 0 0 0-.97-.1l-1.46 1.05c-.48-.26-.98-.47-1.5-.62l-.3-1.77A.75.75 0 0 0 12.5 2h-2a.75.75 0 0 0-.74.62l-.3 1.77c-.52.15-1.02.36-1.5.62L6.5 3.96a.75.75 0 0 0-.97.1l-1.6 1.6a.75.75 0 0 0-.1.97l1.05 1.46c-.26.48-.47.98-.62 1.5l-1.77.3A.75.75 0 0 0 2 11.5v2c0 .36.26.67.62.74l1.77.3c.15.52.36 1.02.62 1.5L3.96 17.5a.75.75 0 0 0 .1.97l1.6 1.6c.24.24.62.28.9.1l1.46-1.05c.48.26.98.47 1.5.62l.3 1.77c.07.36.38.62.74.62h2c.36 0 .67-.26.74-.62l.3-1.77c.52-.15 1.02-.36 1.5-.62l1.46 1.05c.28.18.66.14.9-.1l1.6-1.6c.24-.24.28-.62.1-.9l-1.05-1.46c.26-.48.47-.98.62-1.5l1.77-.3c.36-.07.62-.38.62-.74v-2a.75.75 0 0 0-.62-.74Z"/>
          </svg>
          <span class="label">Settings</span>
        </button>
      </div>
    </header>

    <main class="container">
      <!-- DASHBOARD VIEW -->
      <section id="view-dashboard" class="view is-visible">
        <div class="grid">
          <article class="card rank-card">
            <header>
              <h2>Trader Level</h2>
              <span class="level-name" id="levelName">Novice</span>
            </header>
            <div class="level-track" id="levelTrack">
              <div class="level-progress" id="levelProgress" style="width: 0%"></div>
            </div>
            <div class="next-level muted" id="nextLevel">Next level: <span class="nl-dot" aria-hidden="true"></span><span id="nextLevelName">Apprentice</span></div>
          </article>

          <article class="card balance-card">
            <header>
              <h2>Account Balance</h2>
            </header>
            <div class="balance-row">
              <div>
                <div class="big-number" id="accountBalance">$10,000</div>
                <div class="sub">Equity: <span id="equity">$10,000</span></div>
              </div>
              <div class="pill-group">
                <span class="pill green" id="dailyPL">+ $0</span>
                <span class="pill blue" id="weeklyPL">Week: $0</span>
              </div>
            </div>
            <div class="kpis">
              <div class="kpi">
                <div class="kpi-label">Profit Factor</div>
                <div class="kpi-value" id="profitFactor">—</div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Win Rate</div>
                <div class="kpi-value" id="winRate">—</div>
              </div>
              <div class="kpi">
                <div class="kpi-label">Max Drawdown</div>
                <div class="kpi-value" id="maxDD">—</div>
              </div>
              <div class="kpi">
                <div class="kpi-label">MPI</div>
                <div class="kpi-value" id="mpi">—</div>
              </div>
            </div>
          </article>

          <article class="card achievements-card">
            <header>
              <h2>Money Achievements</h2>
            </header>
            <ul class="badges" id="badges">
              <!-- badges injected -->
            </ul>
            <div class="records">
              <div class="record">
                <span>Biggest Profit</span>
                <strong id="biggestProfit">$0</strong>
              </div>
              <div class="record">
                <span>Biggest Loss</span>
                <strong id="biggestLoss">$0</strong>
              </div>
              <div class="record">
                <span>Best Week</span>
                <strong id="bestWeek">$0</strong>
              </div>
              <div class="record">
                <span>New High Watermark</span>
                <strong id="highWater">$10,000</strong>
              </div>
            </div>
          </article>

          <article class="card challenge-card">
            <header>
              <h2>Weekly Challenge</h2>
            </header>
            <p class="muted">Play a randomized trading week. Log trades. Beat your records. Earn points.</p>
            <div class="row">
              <select id="strategySelect">
                <option>Breakout</option>
                <option>Pullback</option>
                <option>Trend</option>
                <option>News</option>
              </select>
              <select id="pairSelect">
                <option>XAUUSD</option>
                <option>EURUSD</option>
                <option>GBPUSD</option>
                <option>NAS100</option>
              </select>
            </div>
            <div class="row">
              <div class="input-wrap full">
                <input type="date" id="weekStart" class="full" />
                <span class="input-hint">Select date</span>
              </div>
            </div>
            <div class="row">
              <button id="startChallenge" class="primary full">Start</button>
            </div>
            <p class="muted" style="margin-top:8px; font-size:12px">Pick any date (match your chart). The week runs Monday–Friday from that week.</p>
          </article>
        </div>
      </section>

      <!-- CHALLENGE VIEW -->
      <section id="view-challenge" class="view">
        <article class="card">
          <header>
            <h2>Current Week</h2>
          </header>
          <div class="row space-between">
            <div class="pill blue" id="challengeInfo">No active challenge</div>
            <div class="day-actions">
              <span class="current-day pill small" id="currentDay">—</span>
              <button class="secondary small" id="nextDay" disabled>Next Day</button>
              <button class="secondary small" id="endWeek" style="display:none">End Week & Report</button>
            </div>
          </div>
          <div class="row daily-row">
            <div class="pill small" id="dailySummary">Today: 0 trades • P/L $0</div>
          </div>
          <div class="logger">
            <h3>Log Trade</h3>
            <form id="tradeForm">
              <div class="form-row">
                <label>Entry <input type="number" step="0.0001" name="entry" required></label>
                <label>Stop <input type="number" step="0.0001" name="stop" required></label>
                <label>Exit <input type="number" step="0.0001" name="exit" required></label>
              </div>
              <div class="form-row">
                <label>Risk % <input type="number" step="0.1" name="riskPct" value="1" required></label>
                <label>Grade
                  <select name="grade">
                    <option>A</option>
                    <option>B</option>
                    <option>C</option>
                  </select>
                </label>
                <label>Notes <input type="text" name="notes" placeholder="Why this trade?"></label>
              </div>
              <div class="rules-card">
                <div class="rules-title">Trade Rules</div>
                <div class="rules-list">
                  <div class="rule-row">
                    <div class="rule-label">Strategy rules</div>
                    <div class="rating" data-name="ruleStrategyRating" aria-label="Rate Strategy rules 1 to 5">
                      <span class="star" data-val="1">★</span>
                      <span class="star" data-val="2">★</span>
                      <span class="star" data-val="3">★</span>
                      <span class="star" data-val="4">★</span>
                      <span class="star" data-val="5">★</span>
                    </div>
                    <input type="hidden" name="ruleStrategyRating" value="5" />
                  </div>
                  <div class="rule-row">
                    <div class="rule-label">Trade management</div>
                    <div class="rating" data-name="ruleTradeMgmtRating" aria-label="Rate Trade management 1 to 5">
                      <span class="star" data-val="1">★</span>
                      <span class="star" data-val="2">★</span>
                      <span class="star" data-val="3">★</span>
                      <span class="star" data-val="4">★</span>
                      <span class="star" data-val="5">★</span>
                    </div>
                    <input type="hidden" name="ruleTradeMgmtRating" value="5" />
                  </div>
                  <div class="rule-row">
                    <div class="rule-label">Risk management</div>
                    <div class="rating" data-name="ruleRiskMgmtRating" aria-label="Rate Risk management 1 to 5">
                      <span class="star" data-val="1">★</span>
                      <span class="star" data-val="2">★</span>
                      <span class="star" data-val="3">★</span>
                      <span class="star" data-val="4">★</span>
                      <span class="star" data-val="5">★</span>
                    </div>
                    <input type="hidden" name="ruleRiskMgmtRating" value="5" />
                  </div>
                  <div class="rule-row">
                    <div class="rule-label">Trading plan</div>
                    <div class="rating" data-name="rulePlanRating" aria-label="Rate Trading plan 1 to 5">
                      <span class="star" data-val="1">★</span>
                      <span class="star" data-val="2">★</span>
                      <span class="star" data-val="3">★</span>
                      <span class="star" data-val="4">★</span>
                      <span class="star" data-val="5">★</span>
                    </div>
                    <input type="hidden" name="rulePlanRating" value="5" />
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="actions">
                  <button class="primary" type="submit">Add Trade</button>
                  <button class="secondary" type="button" id="markNoTrade" disabled>No Trade</button>
                </div>
              </div>
            </form>
          </div>
          <div class="table-wrap">
            <table class="table" id="tradeTable">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Pair</th>
                  <th>R</th>
                  <th>P/L ($)</th>
                  <th>Grade</th>
                  <th>Rules</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </article>
      </section>

      <!-- RECORDS VIEW -->
      <section id="view-records" class="view">
        <div class="grid">
          <!-- Controls -->
          <article class="card" style="grid-column: span 12;">
            <header><h2>Records & Analytics</h2></header>
            <div class="row">
              <label style="flex:1">Range
                <select id="recRange">
                  <option value="all">All</option>
                  <option value="4">Last 4 weeks</option>
                  <option value="12">Last 12 weeks</option>
                  <option value="26">Last 26 weeks</option>
                </select>
              </label>
              <label style="flex:1">Strategy
                <select id="recStrategy">
                  <option value="all">All</option>
                  <option>Breakout</option>
                  <option>Pullback</option>
                  <option>Trend</option>
                  <option>News</option>
                </select>
              </label>
            </div>
          </article>

          <!-- Totals summary chips -->
          <article class="card" style="grid-column: span 12;">
            <div class="chips">
              <div class="chip"><span class="chip-label">Total Trades</span><strong id="recTotalTrades">0</strong></div>
              <div class="chip green"><span class="chip-label">Wins</span><strong id="recWins">0</strong></div>
              <div class="chip red"><span class="chip-label">Losses</span><strong id="recLosses">0</strong></div>
              <div class="chip blue"><span class="chip-label">Win Rate</span><strong id="recWinRate">0%</strong></div>
            </div>
          </article>

          <!-- Performance Overview: Balance & MPI -->
          <article class="card" style="grid-column: span 6;">
            <header><h2>Balance Growth</h2></header>
            <div class="chart" id="chartBalance"></div>
          </article>
          <article class="card" style="grid-column: span 6;">
            <header><h2>MPI Evolution</h2></header>
            <div class="chart" id="chartMPI"></div>
          </article>

          <!-- Weekly Comparison -->
          <article class="card" style="grid-column: span 7;">
            <header><h2>Weekly Comparison</h2></header>
            <div class="table-wrap">
              <table class="table" id="weeklyCompare">
                <thead>
                  <tr>
                    <th>Week</th>
                    <th>P/L</th>
                    <th>WinRate</th>
                    <th>PF</th>
                    <th>Avg R</th>
                    <th>Trades</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </article>

          <!-- Discipline snapshot -->
          <article class="card" style="grid-column: span 5;">
            <header><h2>Discipline Snapshot</h2></header>
            <div id="discBars" class="bars"></div>
          </article>

          <!-- Milestone Timeline -->
          <article class="card" style="grid-column: span 7;">
            <header><h2>Milestone Timeline</h2></header>
            <ul class="timeline" id="timeline"></ul>
          </article>

          <!-- Records Board (existing) -->
          <article class="card" style="grid-column: span 5;">
            <header><h2>Records Board</h2></header>
            <ul class="records-list" id="recordsList"></ul>
          </article>
        </div>
      </section>

      <!-- LOG VIEW -->
      <section id="view-log" class="view">
        <article class="card">
          <header>
            <h2>Weekly Log</h2>
          </header>
          <div class="chips" style="margin-bottom:10px;">
            <div class="chip"><span class="chip-label">Weeks</span><strong id="logWeeks">0</strong></div>
            <div class="chip"><span class="chip-label">Total Trades</span><strong id="logTotalTrades">0</strong></div>
            <div class="chip blue"><span class="chip-label">Win Rate</span><strong id="logWR">0%</strong></div>
            <div class="chip"><span class="chip-label">Net P/L</span><strong id="logNetPL">$0</strong></div>
            <div class="chip"><span class="chip-label">Avg R:R</span><strong id="logAvgR">—</strong></div>
            <div class="chip"><span class="chip-label">Avg Rules</span><strong id="logAvgRules">—%</strong></div>
          </div>
          <ul class="reports" id="reports"></ul>
        </article>
      </section>

      <!-- SETTINGS VIEW -->
      <section id="view-settings" class="view">
        <article class="card">
          <header><h2>Settings</h2></header>
          <div class="form-row">
            <label>Starting Balance <input type="number" id="startingBalance" value="10000" /></label>
            <label>Base Risk % <input type="number" id="baseRisk" value="1" step="0.1" /></label>
            <button class="secondary" id="saveSettings">Save</button>
          </div>
        </article>
      </section>
    </main>

    <footer class="app-footer">
      <span>Backlogger • Backtesting-as-a-Game</span>
      <span>v0.1.0</span>
    </footer>

    <script src="./src/app.js" type="module"></script>
  </body>
  </html>
